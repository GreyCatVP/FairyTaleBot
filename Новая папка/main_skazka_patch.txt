from story_checker import is_story_complete
from utils import generate_fairytale

async def skazka(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ü–æ–≥–æ–¥–∏ –Ω–µ–º–Ω–æ–≥–æ... —è –≤—Å–ø–æ–º–∏–Ω–∞—é —Å–∫–∞–∑–∫—É... ‚òï")

    for _ in range(3):
        story = await generate_fairytale()
        if is_story_complete(story):
            break
    else:
        story = "–°–∫–∞–∑–∫–∞ —Å–±–µ–∂–∞–ª–∞ –≤ –ª–µ—Å... –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –ø–æ–∑–∂–µ üêæ"

    if len(story) <= 4096:
        await update.message.reply_text(story)
    else:
        for i in range(0, len(story), 4096):
            await update.message.reply_text(story[i:i+4096])